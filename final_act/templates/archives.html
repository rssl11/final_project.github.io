{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Archived Game Scores</h2>
    <a href="{{ url_for('views_bp.admin_dashboard') }}" class="btn btn-secondary mb-3">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
    
    <div class="table-responsive shadow-sm border rounded">
        <table class="table table-striped table-hover align-middle mb-0">
            <thead class="table-dark">
                <tr>
                    <th>Username</th>
                    <th>Game</th>
                    <th>Score</th>
                    <th>Timestamp</th>
                    <th>Status</th>
                    <th style="width: 200px;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for item in archives %}
                <tr>
                    <td><strong>{{ item.username }}</strong></td>
                    <td>{{ item.game_name }}</td>
                    <td>{{ item.score }}</td>
                    <td>{{ item.timestamp }}</td>
                    <td><span class="badge bg-warning text-dark">Archived</span></td>
                    <td>
                        <button class="btn btn-success btn-sm me-1" 
                            data-url="{{ url_for('views_bp.restore_score', score_id=item.id) }}"
                            onclick="confirmAction(this, 'restore')">
                            <i class="fas fa-trash-restore"></i> Restore
                        </button>
                        
                        <button class="btn btn-danger btn-sm" 
                            data-url="{{ url_for('views_bp.delete_score_permanent', score_id=item.id) }}"
                            onclick="confirmAction(this, 'delete')">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center py-4 text-muted">No archived scores found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    // FIX: Function now accepts the button element 'btn' instead of the raw URL string
    function confirmAction(btn, actionType) {
        // Retrieve the URL safely from the data attribute
        const url = btn.getAttribute('data-url');
        
        let title, text, icon, confirmBtnText, confirmBtnColor;

        if (actionType === 'restore') {
            title = 'Restore Score?';
            text = "This will move the score back to the active dashboard.";
            icon = 'question';
            confirmBtnText = 'Yes, Restore it!';
            confirmBtnColor = '#198754'; // Success Green
        } else if (actionType === 'delete') {
            title = 'Permanently Delete?';
            text = "You cannot undo this action. The data will be deleted from the database forever.";
            icon = 'warning';
            confirmBtnText = 'Yes, Delete it!';
            confirmBtnColor = '#dc3545'; // Danger Red
        }

        Swal.fire({
            title: title,
            text: text,
            icon: icon,
            showCancelButton: true,
            confirmButtonColor: confirmBtnColor,
            cancelButtonColor: '#6c757d',
            confirmButtonText: confirmBtnText
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = url;
            }
        })
    }
</script>
{% endblock %}