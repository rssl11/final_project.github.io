{% extends "base.html" %}
{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="height: 80vh;">
    <div class="card shadow p-4 text-center border-danger" style="width: 400px;">
        <h4 class="mb-3">Reset Password Verification</h4>
        
        <div class="mb-3">
            <span class="badge bg-secondary p-2" style="font-size: 1.1rem;">
                Time Remaining: <span id="timer">Loading...</span>
            </span>
        </div>

        <p class="text-muted">Enter the OTP sent to your email to reset your password.</p>
        
        <form method="POST">
            <input type="text" name="otp" id="otpInput" class="form-control text-center mb-3" placeholder="Enter OTP" required>
            <button type="submit" id="verifyBtn" class="btn btn-danger w-100">Verify</button>
        </form>

        <div id="resendSection" class="mt-3" style="display: none;">
            <p class="text-danger small mb-1">Code expired?</p>
            <a href="{{ url_for('auth_bp.resend_otp', context='reset') }}" class="btn btn-outline-dark btn-sm w-100">
                <i class="fas fa-redo"></i> Resend OTP
            </a>
        </div>
    </div>
</div>

<script>
    // We use quotes "..." and parseFloat to stop VS Code from showing syntax errors
    var rawTime = "{{ expire_timestamp|default(0) }}";
    var expireTime = parseFloat(rawTime) * 1000; 

    function updateTimer() {
        var now = new Date().getTime();
        var distance = expireTime - now;

        if (distance < 0) {
            // EXPIRED
            document.getElementById("timer").innerHTML = "EXPIRED";
            document.getElementById("timer").className = "badge bg-danger p-2"; // Change color to red
            
            // Disable inputs
            document.getElementById("verifyBtn").disabled = true;
            document.getElementById("otpInput").disabled = true;
            
            // Show Resend Button
            document.getElementById("resendSection").style.display = "block";
        } else {
            // RUNNING
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Add leading zero
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;

            document.getElementById("timer").innerHTML = minutes + ":" + seconds;
            document.getElementById("resendSection").style.display = "none";
        }
    }

    // Run immediately then every 1 second
    updateTimer();
    var x = setInterval(updateTimer, 1000);
</script>
{% endblock %}